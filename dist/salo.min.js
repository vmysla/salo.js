function w(d,f){function x(){}function q(){h=l=0;d.set("buildHitTask",y);d.set("sendHitTask",m)}function r(a){d.set("buildHitTask",t);d.set("sendHitTask",m);a&&d.send("exception",{exDescription:"[salo.js] "+a.message,nonInteraction:!0,exFatal:!1})}function z(a){for(var b,e=!1,c=n.length;!e&&c--;){b=n[c];var e=!0,d;for(d in b)a.get(d)!=b[d]&&(e=!1)}return e?(b="salo"+(new k.Date).getTime(),a=a.get("hitPayload"),g.set(b,a,{a:A})&&b):!1}function u(){if(!(0<h))for(var a=g.index(),b=0;b<a.length;){var e=
a[b++],c=e.match(/^salo(\d+)$/);if(c&&(c=e.match(/^salo(\d+)$/),c=parseInt(c[1],10),c=(new k.Date).getTime()-c,d.send({hitType:"salo",saloId:e,queueTime:c})))return!0}}function B(a){a+="lock";if(g.get(a))return!1;g.set(a,1,{a:p});return!0}function v(a){return function(b,e){try{a(b,e)}catch(c){r(c)}}}var C={enable:q,disable:r,watch:function(a){n.push(a)}},n=[{useSalo:!0,useBeacon:!1,hitCallback:void 0,transport:void 0}],l,h;f=f||{};var A=f.storageTimeout||108E5,p=f.transportTimeout||5E3,k=f.timing||
window,g=f.storage||window.simpleStorage,t=d.get("buildHitTask"),D=d.get("sendHitTask"),y=v(function(a){if("salo"!=a.get("hitType"))t(a);else{var b,e,c;if(b=/^salo(\d+)$/i.exec(a.get("saloId")))e=b[0],c=b[1],b=g.get(storageKey),c=(new k.Date).getTime()-c,a.set("hitPayload",b+"&qt="+c),m(a,e)}}),m=v(function(a,b){b||(b=z(a),l++);if(!b||!h&&B(b)){var e=k.setTimeout(function(){d||(e=k.setTimeout(u,p),d=!0,h--)},p),c=a.get("hitCallback")||x,d=!1;a.set("hitCallback",function(){e&&k.clearTimeout(e);if(b){var a=
b;g.b(a);g.b(a+"lock")}d||(d=!0,h--);if(c){try{c()}catch(f){}c=void 0}u()},!0);l--;h++;D(a)}});q();return C}"undefined"!==typeof exports&&(module.c=w);